#!/bin/bash

set -e

# TODO: Check for version numbers based on minimum system requirements
# TODO: Check that code is executed from top of repo

if ! [ -x "$(command -v docker)" ]; then
  echo 'Error: docker is not installed' >&2
  exit 1
fi

if ! [ -x "$(command -v docker-compose)" ]; then
  echo 'Error: docker-compose is not installed' >&2
  exit 1
fi

# pull and initialize a GIPS processing instance and ancillary data
# GIPS lives in a separate open source repo
#CONFDIR=${PWD}/conf

aws s3 cp s3://rob-scratch/gips/gips_init.tgz ./
tar xvfz gips_init.tgz

# the GIPS container needs some content that is not in the GIPS repo:
# data center credentials, sixs, long term mean AOD, project-specific vector data
#mkdir -p $CONFDIR/vector
#aws s3 sync s3://rob-scratch/gips/conf ${CONFDIR}
#aws s3 sync s3://rob-scratch/gips/vector ${CONFDIR}/vector

./scripts/update "$@"
